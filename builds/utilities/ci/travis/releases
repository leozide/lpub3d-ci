#!/bin/bash
#
# Travis build [release] procedures
#
#  Trevor SANDY <trevor.sandy@gmail.com>
#  Last Update: December 22, 2017
#  Copyright (c) 2017 by Trevor SANDY
#
cd $LP3D_BUILD_FOLDER

# GitHub release deployment
echo "Deploying to GitHub releases ...";
# Download release files from Dropbox store
if [ -f "${LP3D_UPLOADER_DIR}/.dropbox_uploader" ]; then
  chmod +x "${LP3D_UPLOADER_DIR}/dropbox_uploader.sh";
  ./"${LP3D_UPLOADER_DIR}/dropbox_uploader.sh" list "$LP3D_DROPBOX_DOWNLOADS_DIR";
  ./"${LP3D_UPLOADER_DIR}/dropbox_uploader.sh" download /"$LP3D_DROPBOX_DOWNLOADS_DIR" "$LP3D_RELEASES_DIR"/;
else
  echo "ERROR - ${LP3D_UPLOADER_DIR}/.dropbox_uploader not found - cannot perform file download";
fi;
# Verify release files in the Releases directory
if [ -n "$(find "$LP3D_DOWNLOADS_DIR" -maxdepth 0 -type d -empty 2>/dev/null)" ]; then
  echo "$LP3D_DOWNLOADS_DIR is empty. GitHub release aborted.";
  export LP3D_DEPLOY_PKG=no;
else
  echo "Release Files:" && find $LP3D_DOWNLOADS_DIR -type f;
fi

