# Maintainer: Trevor SANDY <trevor[dot]sandy[at]gmail[dot]com>
pkgname=lpub3d-ci
pkgver=2.0.21.197
pkgrel=1
pkgdesc="An LDraw Building Instruction Editor"
url="https://github.com/trevorsandy/lpub3d-ci.git"
arch=('x86_64' 'i686')
license=('GPL3')
depends=('qt5-base' 'qt5-tools' 'freeglut' 'boost-libs')
makedepends=()
conflicts=()
replaces=()
backup=()
source=("lpub3d-ci-git.tar.gz" "complete.zip" "lpub3dldrawunf.zip" "lpub3d_linux_3rdparty.tar.gz")
noextract=("complete.zip" "lpub3dldrawunf.zip" "lpub3d_linux_3rdparty.tar.gz")
md5sums=(SKIP SKIP SKIP SKIP)

prepare() {
	echo "Current working directory: $PWD"
	if [ -f lpub3d_linux_3rdparty.tar.gz ]; then
			mkdir -p lpub3d_linux_3rdparty && tar -xzf lpub3d_linux_3rdparty.tar.gz -C lpub3d_linux_3rdparty --strip-components=1
			echo "lpub3d_linux_3rdparty tarball extracted to lpub3d_linux_3rdparty/"
			rm -f lpub3d_linux_3rdparty.tar.gz &&  echo "lpub3d_linux_3rdparty tarball deleted"
	else
			echo "lpub3d_linux_3rdparty tarball not found at $PWD!"
	fi
	cd ${pkgname}-git
	echo "Current working directory: $PWD"
	if [ -f ../complete.zip ] ; then
		cp ../complete.zip mainApp/extras
		echo "LDraw archive library complete.zip copied"
	else
		echo "complete.zip not found at $PWD"
	fi
	if [ -f ../lpub3dldrawunf.zip ] ; then
		cp ../lpub3dldrawunf.zip mainApp/extras
		echo "LDraw archive library lpub3dldrawunf.zip copied"
	else
		echo "lpub3dldrawunf.zip not found at $PWD"
	fi
	export QT_SELECT=qt5
	export LP3D_BUILD_PKG=yes
	if [ -x /usr/bin/qmake ] ; then
		qmake -makefile CONFIG+=release CONFIG+=pkg
	elif [ -x /usr/bin/qmake-qt5 ] ; then
		qmake-qt5 -makefile CONFIG+=release CONFIG+=pkg
	fi
}

build() {
	cd ${pkgname}-git
	make clean
	make
}

package() {
	cd ${pkgname}-git
	make INSTALL_ROOT=${pkgdir} install
}
