# Maintainer: Trevor SANDY <trevor[dot]sandy[at]gmail[dot]com>
pkgname=lpub3d-ci
pkgver=2.0.21.117
pkgrel=1
pkgdesc="An LDraw Building Instruction Editor"
url="https://github.com/trevorsandy/lpub3d-ci.git"
arch=('x86_64' 'i686')
license=('GPL3')
depends=('qt5-base' 'qt5-tools')
makedepends=()
conflicts=()
replaces=()
backup=()
source=("lpub3d-ci-git.tar.gz" "complete.zip" "lpub3dldrawunf.zip" "lpub3d_linux_3rdparty")
noextract=("complete.zip" "lpub3dldrawunf.zip" "lpub3d_linux_3rdparty")
md5sums=(SKIP SKIP SKIP SKIP)

prepare() {
	# for 3rd party apps install
	export LP3D_CREATE_PKG=true

	cd ${pkgname}-git

	# Start custom configuration commands
	echo "Current working directory: $PWD"
	if [ -f ../complete.zip ] ; then
		cp ../complete.zip mainApp/extras
		echo "LDraw archive library complete.zip copied"
	else
		echo "complete.zip not found at $PWD"
	fi
	if [ -f ../lpub3dldrawunf.zip ] ; then
		cp ../lpub3dldrawunf.zip mainApp/extras
		echo "LDraw archive library lpub3dldrawunf.zip copied"
	else
		echo "lpub3dldrawunf.zip not found at $PWD"
	fi
	if [ -f ../lpub3d_linux_3rdparty.tar.gz ]; then
			mkdir ../lpub3d_linux_3rdparty && tar -xzf lpub3d_linux_3rdparty.tar.gz -C ../lpub3d_linux_3rdparty --strip-components=1
			echo "lpub3d_linux_3rdparty tarball extracted"
	else
			echo "lpub3d_linux_3rdparty tarball not found at $PWD!"
	fi

	# Qt5 configure
	export QT_SELECT=qt5
	if [ -x /usr/bin/qmake ] ; then
		qmake -makefile CONFIG+=release CONFIG+=pkg
	elif [ -x /usr/bin/qmake-qt5 ] ; then
		qmake-qt5 -makefile CONFIG+=release CONFIG+=pkg
	fi
	# End custom configuration commands
}

build() {
	cd ${pkgname}-git
	make clean
	make
}

package() {
	cd ${pkgname}-git
	make INSTALL_ROOT=${pkgdir} install
}
